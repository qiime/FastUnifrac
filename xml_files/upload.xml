<?xml version="1.0"?>

<tool name="Upload File" id="upload1" version="1.0">
  <description>
    from your computer  
  </description>
  <action module="galaxy.tools.actions.upload" class="UploadToolAction"/>

  <command interpreter='python'>
      upload.py $GALAXY_ROOT_DIR $GALAXY_DATATYPES_CONF_FILE $paramfile
    #set $outnum = 0
    #while $varExists('output%i' % $outnum):
        #set $output = $getVar('output%i' % $outnum)
        #set $outnum += 1
        #set $file_name = $output.file_name
        #if $output.dataset.dataset.external_filename:
            #set $file_name = "None"
        #end if
        ${output.dataset.dataset.id}:${output.files_path}:${file_name}
    #end while
  </command>

  <inputs nginx_upload="true">
    <param name="file_type" type="hidden" label="File Format" help="Which format? See help below" value="auto">
      <options from_parameter="tool.app.datatypes_registry.upload_file_formats" transform_lines="[ &quot;%s%s%s&quot; % ( line, self.separator, line ) for line in obj ]">
        <column name="value" index="1"/>
        <column name="name" index="0"/>
        <filter type="sort_by" column="0"/>
        <filter type="add_value" name="Auto-detect" value="auto" index="0"/>
      </options>
    </param>
    <param name="async_datasets" type="hidden" value="None"/>
    <upload_dataset name="files" title="Specify Files for Dataset">
        <param name="file_data" type="file" size="30" label="File" ajax-upload="true" help="TIP: Due to browser limitations, uploading files larger than 2GB is guaranteed to fail.">
        <validator type="expression" message="You will need to reselect the file you specified (%s)." substitute_value_in_message="True">not ( ( isinstance( value, unicode ) or isinstance( value, str ) ) and value != "" )</validator>
      </param>
      <param name="url_paste" type="hidden" area="true" size="5x35" label="URL/Text" help="Here you may specify a list of URLs (one per line) or paste the contents of a file."/>
      <param name="ftp_files" type="ftpfile" label="Files uploaded via FTP"/>
    </upload_dataset>
  </inputs>
  <help>
**Tree file**

The uploaded tree must contain sequences from at least three differents samples and can be generated by programs such as Arb, Phylip, PAUP*. MtBayes, RAxML, or Clustal W. The tree should be rooted. Loading an unrooted tree will usually result in the assignment of an arbitrary root. The quality of the Fast UniFrac analysis results depends on the quality of the input tree.

The tree should be in NEWICK format. NEWICK is a standard format that is recognized by most programs that generate or allow visualization of phylogenetic trees including PHYLIP, TREE-PUZZLE, ARB, and TREEVIEW. Here is an example of a tree in NEWICK format:

.. image:: ./static/images/fastunifrac/upload/newick_format.png

-----

**Sample ID mapping file**

This file maps each sequence ID in the tree file to the sample ID that each sequence came from. Each line in the sample ID mapping file has a sequence ID and a sample ID separated by a tab. If the same sequences was found in more than one sample, it should be represented by more than one line. Here is an example of a sample ID mapping file:

.. image:: ./static/images/fastunifrac/upload/sample_id.png

Optionally, the sample ID mapping file can contain a third column, containing the number of times that the sequence was observed in each sample. This data come from RFLP dara or OTU counts. This type of information is used when applying weighted UniFrac, which accounts for sequence abundance when comparing diversity. Here is an example of a sample ID mapping file that includes abundance information:

.. image:: ./static/images/fastunifrac/upload/sample_id_3.png

-----

**Category mapping file**

The category mapping file contains additional metadata abput the samples, and is a table relating each sample to parameters you have measured such as temperature, pH, etc, as well as a sample descriptions. In general, people usually prepare this mapping file using Excel, although it is important to save them as plain text format (tab-delimited) and no as Excel documents.

This file format is tab-delimited text. The first line is a header line that must start with a "#" character.

Optionally, a general description of the input files can be included in the lines immediately following the header line that start with a "#".

The first column must be named SampleID, must contain unique (short, meaningful) sample IDs containing only alphanumeric characters. (With the exception of ".")

The second column to "n-1 th" column are subcategories. These can be anything (random assignment if you want) but each subcategory should be a small number of distinct values less or equal to the  number of samples. There must be at least two unique values for each category.

The last column must be named "Description" and contains the shourt descriptions for the samples.

Here is an example of category mapping file:

.. image:: ./static/images/fastunifrac/upload/category_map.png

  </help>
</tool>
